<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>TG Panel - Telegram Sessions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #050716;
      --card-bg: #0f172a;
      --card-border: #1f2937;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --warning: #facc15;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #1d283a 0, #050716 45%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 24px;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.1fr);
      gap: 20px;
    }
    @media (max-width: 900px) {
      body {
        padding: 12px;
      }
      .container {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      background: radial-gradient(circle at top, rgba(148,163,184,0.16), transparent 55%) , var(--card-bg);
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow:
        0 18px 45px rgba(15,23,42,0.9),
        0 0 0 1px rgba(148,163,184,0.18);
      padding: 18px 18px 16px;
      backdrop-filter: blur(24px);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top right, rgba(56,189,248,0.12), transparent 60%),
        radial-gradient(circle at bottom left, rgba(129,140,248,0.12), transparent 65%);
      opacity: 0.75;
      pointer-events: none;
      mix-blend-mode: screen;
    }
    .card-inner {
      position: relative;
      z-index: 1;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }
    .title {
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .title span.badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.7);
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--muted);
    }
    .title-gradient {
      background: linear-gradient(120deg, #e5e7eb, #bae6fd, #a5b4fc);
      -webkit-background-clip: text;
      color: transparent;
    }
    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top left, rgba(59,130,246,0.25), transparent 55%);
    }
    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 6px rgba(74,222,128,0.18);
    }
    .sessions-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      margin-top: 4px;
      max-height: 440px;
      overflow: auto;
      padding-right: 6px;
    }
    @media (min-width: 1100px) {
      .sessions-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    .session-card {
      background: rgba(15,23,42,0.92);
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 12px 12px 10px;
      position: relative;
      overflow: hidden;
    }
    .session-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.19), transparent 60%);
      opacity: 0.9;
      mix-blend-mode: screen;
      pointer-events: none;
    }
    .session-main {
      position: relative;
      z-index: 1;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: flex-start;
    }
    .session-name {
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--muted);
      box-shadow: 0 0 0 3px rgba(148,163,184,0.3);
    }
    .status-dot.active {
      background: var(--success);
      box-shadow: 0 0 0 3px rgba(74,222,128,0.3);
    }
    .status-dot.syncing {
      background: var(--warning);
      box-shadow: 0 0 0 3px rgba(250,204,21,0.3);
    }
    .status-dot.error {
      background: var(--danger);
      box-shadow: 0 0 0 3px rgba(248,113,113,0.3);
    }
    .session-meta {
      margin-top: 4px;
      font-size: 11px;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
    }
    .meta-pill {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.8);
    }
    .session-actions {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }
    button {
      border: none;
      cursor: pointer;
      font: inherit;
      color: inherit;
      background: transparent;
    }
    .btn {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: radial-gradient(circle at top left, rgba(56,189,248,0.3), rgba(15,23,42,0.95));
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.14s ease-out;
      white-space: nowrap;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(15,23,42,0.8);
      border-color: rgba(191,219,254,0.9);
    }
    .btn-ghost {
      background: rgba(15,23,42,0.88);
      border-color: rgba(148,163,184,0.5);
    }
    .btn-danger {
      background: linear-gradient(135deg, rgba(248,113,113,0.2), rgba(127,29,29,0.95));
      border-color: rgba(248,113,113,0.8);
    }
    .btn-sm {
      padding: 4px 9px;
      font-size: 10px;
    }
    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--muted);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .section-title span.indicator {
      font-size: 11px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }
    label {
      font-size: 12px;
      color: var(--muted);
    }
    input {
      width: 100%;
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: border-color 0.1s ease-out, box-shadow 0.1s ease-out, background 0.1s ease-out;
    }
    input:focus {
      border-color: rgba(56,189,248,0.9);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
      background: rgba(15,23,42,1);
    }
    .helper {
      font-size: 11px;
      color: var(--muted);
    }
    .code-input {
      letter-spacing: 0.32em;
      text-align: center;
      font-weight: 600;
    }
    .log {
      margin-top: 8px;
      font-size: 11px;
      max-height: 150px;
      overflow: auto;
      padding: 8px 9px;
      border-radius: 12px;
      background: rgba(15,23,42,0.92);
      border: 1px solid rgba(30,64,175,0.7);
    }
    .log-line {
      color: var(--muted);
      margin-bottom: 3px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .log-line time {
      color: rgba(148,163,184,0.9);
      font-size: 10px;
      margin-right: 6px;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .chip {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.95);
      color: var(--muted);
    }
    .badge-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 16px;
      height: 16px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 10px;
      padding: 0 5px;
    }
    .notif-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }
    .notif-panel {
      width: 100%;
      max-width: 720px;
      max-height: 480px;
      background: radial-gradient(circle at top, rgba(148,163,184,0.18), transparent 55%), #020617;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 30px 80px rgba(15,23,42,0.95);
      padding: 14px 16px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .notif-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
    }
    .notif-list {
      flex: 1;
      overflow: auto;
      padding-right: 4px;
      font-size: 12px;
    }
    .notif-item {
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(31,41,55,0.9);
      background: radial-gradient(circle at top left, rgba(15,118,110,0.35), rgba(15,23,42,0.95));
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .notif-item.error {
      background: radial-gradient(circle at top left, rgba(248,113,113,0.28), rgba(15,23,42,0.96));
      border-color: rgba(127,29,29,0.9);
    }
    .notif-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .notif-link {
      color: #bfdbfe;
      word-break: break-all;
    }
    .notif-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="container">
    <main class="card">
      <div class="card-inner">
        <div class="card-header">
          <div>
            <div class="title">
              <span class="badge">TG PANEL</span>
              <span class="title-gradient">Telegram Sessions</span>
            </div>
            <div class="chips">
              <span class="chip">MTProto userbot</span>
              <span class="chip">Auto-join t.me</span>
              <span class="chip">Multi-session</span>
            </div>
          </div>
          <div class="pill">
            <span class="pill-dot"></span>
            <span>–ü–∞–Ω–µ–ª—å –æ–Ω–ª–∞–π–Ω</span>
          </div>
        </div>

        <div class="section-title">
          <span>–°–µ—Å—Å–∏–∏ Telegram</span>
          <span class="indicator">
            <span>–í—Å–µ–≥–æ: <span id="totalSessions">0</span></span>
          </span>
        </div>

        <div id="sessions" class="sessions-grid">
          <!-- Sessions will be rendered here -->
        </div>

        <div style="margin-top:8px; display:flex; justify-content:flex-end;">
          <button id="openNotifications" class="btn btn-ghost btn-sm">
            <span>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
          </button>
        </div>
      </div>
    </main>

    <aside class="card">
      <div class="card-inner">
        <div class="section-title">
          <span>–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è</span>
          <span class="indicator">
            <span id="currentStatus">–û–∂–∏–¥–∞–µ—Ç –≤–≤–æ–¥–∞‚Ä¶</span>
          </span>
        </div>

        <div class="field-group">
          <label for="sessionName">–ò–º—è —Å–µ—Å—Å–∏–∏</label>
          <input id="sessionName" placeholder="my_account_1" />
          <div class="helper">–õ–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã, _ –∏ -</div>
        </div>

        <div class="field-group">
          <label for="phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
          <input id="phone" placeholder="+79991234567" />
          <div class="helper">–ù–æ–º–µ—Ä Telegram-–∞–∫–∫–∞—É–Ω—Ç–∞ –¥–ª—è userbot-—Å–µ—Å—Å–∏–∏</div>
        </div>

        <button id="createSession" class="btn" style="width:100%; justify-content:center; margin-bottom:10px;">
          <span>‚ûï –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</span>
        </button>

        <div class="field-group">
          <label for="authCode">–ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–∑ Telegram)</label>
          <input id="authCode" class="code-input" maxlength="10" placeholder="12345" />
          <div class="helper">–ü–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–µ—Å—Å–∏–∏ –∫–æ–¥ –ø—Ä–∏–¥—ë—Ç –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram</div>
        </div>

        <button id="confirmCode" class="btn btn-ghost" style="width:100%; justify-content:center;">
          <span>‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</span>
        </button>

        <div class="section-title" style="margin-top:16px;">
          <span>–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É</span>
        </div>

        <div class="field-group">
          <label for="joinLink">t.me —Å—Å—ã–ª–∫–∞</label>
          <input id="joinLink" placeholder="https://t.me/your_group_or_invite" />
          <div class="helper">–í—ã–¥–µ–ª–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –≤—Å—Ç—É–ø–∏—Ç –≤ –≥—Ä—É–ø–ø—É –ø–æ —Å—Å—ã–ª–∫–µ</div>
        </div>

        <button id="joinGroup" class="btn btn-ghost" style="width:100%; justify-content:center;">
          <span>üîó –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ</span>
        </button>

        <div class="section-title" style="margin-top:16px;">
          <span>–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã</span>
        </div>

        <div class="field-group">
          <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è–º–∏ (—Å–µ–∫.)</label>
          <div style="display:flex; gap:8px;">
            <input id="intervalMin" type="number" min="3" max="3600" style="flex:1;" placeholder="–º–∏–Ω, –Ω–∞–ø—Ä. 5" />
            <input id="intervalMax" type="number" min="3" max="3600" style="flex:1;" placeholder="–º–∞–∫—Å, –Ω–∞–ø—Ä. 30" />
          </div>
          <div class="helper">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5‚Äì30 —Å–µ–∫. –î–∏–∞–ø–∞–∑–æ–Ω 3‚Äì3600 —Å–µ–∫.</div>
        </div>

        <button id="saveIntervals" class="btn btn-ghost" style="width:100%; justify-content:center;">
          <span>‚è±Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã</span>
        </button>

        <div class="log" id="log"></div>
      </div>
    </aside>
  </div>

  <div id="notifOverlay" class="notif-overlay">
    <div class="notif-panel">
      <div class="notif-header">
        <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π</span>
        <div style="display:flex; gap:6px;">
          <button id="clearNotifications" class="btn btn-sm btn-ghost">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
          <button id="closeNotifications" class="btn btn-sm btn-danger">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
      <div id="notifList" class="notif-list"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const sessionsContainer = document.getElementById('sessions');
    const totalSessionsSpan = document.getElementById('totalSessions');
    const currentStatusSpan = document.getElementById('currentStatus');
    const logEl = document.getElementById('log');

    const createSessionBtn = document.getElementById('createSession');
    const confirmCodeBtn = document.getElementById('confirmCode');
    const joinGroupBtn = document.getElementById('joinGroup');
      const saveIntervalsBtn = document.getElementById('saveIntervals');
      const openNotificationsBtn = document.getElementById('openNotifications');
      const closeNotificationsBtn = document.getElementById('closeNotifications');
      const clearNotificationsBtn = document.getElementById('clearNotifications');

    const sessionNameInput = document.getElementById('sessionName');
    const phoneInput = document.getElementById('phone');
    const authCodeInput = document.getElementById('authCode');
    const joinLinkInput = document.getElementById('joinLink');
      const intervalMinInput = document.getElementById('intervalMin');
      const intervalMaxInput = document.getElementById('intervalMax');
      const notifOverlay = document.getElementById('notifOverlay');
      const notifList = document.getElementById('notifList');

    let lastCreatedSession = null;
    let lastNotifications = [];

    function log(message, type = 'info') {
      const line = document.createElement('div');
      line.className = 'log-line';
      const ts = document.createElement('time');
      ts.textContent = new Date().toLocaleTimeString('ru-RU', { hour12: false });
      line.appendChild(ts);
      const span = document.createElement('span');
      span.textContent = ' ' + message;
      if (type === 'error') {
        span.style.color = '#fca5a5';
      } else if (type === 'success') {
        span.style.color = '#bbf7d0';
      }
      line.appendChild(span);
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function statusText(status) {
      switch (status) {
        case 'active': return '–ê–∫—Ç–∏–≤–Ω–∞';
        case 'auth': return '–û–∂–∏–¥–∞–µ—Ç –∫–æ–¥–∞';
        case 'error': return '–û—à–∏–±–∫–∞';
        case 'inactive':
        default: return '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
      }
    }

    function renderNotifications() {
      notifList.innerHTML = '';
      if (!lastNotifications.length) {
        const empty = document.createElement('div');
        empty.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.';
        empty.style.color = '#9ca3af';
        notifList.appendChild(empty);
        return;
      }
      lastNotifications.forEach((n) => {
        const item = document.createElement('div');
        item.className = 'notif-item' + (n.success ? '' : ' error');
        const top = document.createElement('div');
        top.className = 'notif-top';
        const title = document.createElement('div');
        title.textContent = n.success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ' : '‚ùå –û—à–∏–±–∫–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è';
        const time = document.createElement('div');
        const d = new Date(n.at);
        time.textContent = d.toLocaleTimeString('ru-RU', { hour12: false }) + ' ' + d.toLocaleDateString('ru-RU');
        time.style.fontSize = '11px';
        time.style.color = '#9ca3af';
        top.appendChild(title);
        top.appendChild(time);
        item.appendChild(top);

        const link = document.createElement('div');
        link.className = 'notif-link';
        link.textContent = n.link;
        item.appendChild(link);

        const meta = document.createElement('div');
        meta.className = 'notif-meta';
        const s = document.createElement('span');
        s.textContent = '–°–µ—Å—Å–∏—è: ' + n.session;
        meta.appendChild(s);
        if (!n.success && n.error) {
          const err = document.createElement('span');
          err.textContent = '–û—à–∏–±–∫–∞: ' + n.error;
          meta.appendChild(err);
        }
        item.appendChild(meta);

        notifList.appendChild(item);
      });
    }

    function renderSessions(sessions) {
      sessionsContainer.innerHTML = '';
      totalSessionsSpan.textContent = sessions.length;
      if (!sessions.length) {
        const empty = document.createElement('div');
        empty.textContent = '–°–µ—Å—Å–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å–ø—Ä–∞–≤–∞.';
        empty.style.fontSize = '12px';
        empty.style.color = '#9ca3af';
        sessionsContainer.appendChild(empty);
        return;
      }

      sessions.forEach(s => {
        const card = document.createElement('div');
        card.className = 'session-card';

        const main = document.createElement('div');
        main.className = 'session-main';

        const left = document.createElement('div');
        const name = document.createElement('div');
        name.className = 'session-name';
        const dot = document.createElement('span');
        dot.className = 'status-dot ' + (s.status || 'inactive');
        name.appendChild(dot);
        const nameText = document.createElement('span');
        nameText.textContent = s.name;
        name.appendChild(nameText);
        left.appendChild(name);

        const meta = document.createElement('div');
        meta.className = 'session-meta';
        const st = document.createElement('span');
        st.className = 'meta-pill';
        st.textContent = '–°—Ç–∞—Ç—É—Å: ' + statusText(s.status);
        meta.appendChild(st);
        if (s.phone) {
          const ph = document.createElement('span');
          ph.className = 'meta-pill';
          ph.textContent = 'üìû ' + s.phone;
          meta.appendChild(ph);
        }
        if (typeof s.joinQueueLength === 'number') {
          const q = document.createElement('span');
          q.className = 'meta-pill';
          q.innerHTML = '–û—á–µ—Ä–µ–¥—å: <strong>' + s.joinQueueLength + '</strong>';
          meta.appendChild(q);
        }
        if (s.intervals && typeof s.intervals.min === 'number' && typeof s.intervals.max === 'number') {
          const it = document.createElement('span');
          it.className = 'meta-pill';
          it.textContent = `‚è± ${s.intervals.min}-${s.intervals.max} —Å–µ–∫`;
          meta.appendChild(it);
        }
        if (s.lastJoin && s.lastJoin.link && s.lastJoin.at) {
          const lj = document.createElement('span');
          lj.className = 'meta-pill';
          const d = new Date(s.lastJoin.at);
          const t = d.toLocaleTimeString('ru-RU', { hour12: false });
          const day = d.toLocaleDateString('ru-RU');
          lj.textContent = `üîó –ü–æ—Å–ª–µ–¥–Ω–µ–µ: ${t} ${day}`;
          lj.title = `–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ:\n${s.lastJoin.link}`;
          meta.appendChild(lj);
        }
        left.appendChild(meta);

        const right = document.createElement('div');
        right.className = 'session-actions';

        const joinBadge = document.createElement('span');
        joinBadge.className = 'badge-number';
        joinBadge.textContent = s.joinQueueLength || 0;
        right.appendChild(joinBadge);

        if (s.status !== 'active') {
          const actBtn = document.createElement('button');
          actBtn.className = 'btn btn-sm btn-ghost';
          actBtn.textContent = '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å';
          actBtn.onclick = async (ev) => {
            ev.stopPropagation();
            try {
              log(`–ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ ${s.name}‚Ä¶`);
              const res = await fetch(`/api/tg/sessions/${encodeURIComponent(s.name)}/activate`, {
                method: 'POST',
              });
              const data = await res.json();
              if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏');
              log(`–°–µ—Å—Å–∏—è ${s.name} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞`, 'success');
              await loadSessions();
            } catch (e) {
              log(`–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ${s.name}: ${e.message}`, 'error');
            }
          };
          right.appendChild(actBtn);
        }

        const delBtn = document.createElement('button');
        delBtn.className = 'btn btn-sm btn-danger';
        delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
        delBtn.onclick = async () => {
          if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é ${s.name}?`)) return;
          try {
            const res = await fetch(`/api/tg/sessions/${encodeURIComponent(s.name)}`, {
              method: 'DELETE'
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è');
            log(`–°–µ—Å—Å–∏—è ${s.name} —É–¥–∞–ª–µ–Ω–∞`, 'success');
            loadSessions();
          } catch (e) {
            log(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è ${s.name}: ${e.message}`, 'error');
          }
        };
        right.appendChild(delBtn);

        main.appendChild(left);
        main.appendChild(right);
        card.appendChild(main);
        sessionsContainer.appendChild(card);

        card.onclick = () => {
          sessionNameInput.value = s.name;
          lastCreatedSession = s.name;
          currentStatusSpan.textContent = `–í—ã–±—Ä–∞–Ω–∞ —Å–µ—Å—Å–∏—è: ${s.name}`;
          if (s.intervals) {
            intervalMinInput.value = s.intervals.min ?? '';
            intervalMaxInput.value = s.intervals.max ?? '';
          }
        };
      });
    }

    async function loadSessions() {
      try {
        const res = await fetch('/api/tg/sessions');
        const data = await res.json();
        renderSessions(data || []);
      } catch (e) {
        log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–π: ' + e.message, 'error');
      }
    }

    createSessionBtn.onclick = async () => {
      const name = sessionNameInput.value.trim();
      const phone = phoneInput.value.trim();
      if (!name || !phone) {
        log('–£–∫–∞–∂–∏—Ç–µ –∏–º—è —Å–µ—Å—Å–∏–∏ –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
        return;
      }
      try {
        currentStatusSpan.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏‚Ä¶';
        const res = await fetch('/api/tg/sessions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, phone })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è');
        lastCreatedSession = data.name;
        log(`–°–µ—Å—Å–∏—è ${data.name} —Å–æ–∑–¥–∞–Ω–∞. –ö–æ–¥ –ø—Ä–∏–¥—ë—Ç –≤ Telegram`, 'success');
        currentStatusSpan.textContent = `–û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è ${data.name}`;
        await loadSessions();
      } catch (e) {
        currentStatusSpan.textContent = '–û—à–∏–±–∫–∞';
        log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏: ' + e.message, 'error');
      }
    };

    confirmCodeBtn.onclick = async () => {
      const code = authCodeInput.value.trim();
      const name = sessionNameInput.value.trim() || lastCreatedSession;
      if (!name) {
        log('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é', 'error');
        return;
      }
      if (!code) {
        log('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
        return;
      }
      try {
        currentStatusSpan.textContent = `–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è ${name}‚Ä¶`;
        const res = await fetch(`/api/tg/sessions/${encodeURIComponent(name)}/confirm`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
        log(`–°–µ—Å—Å–∏—è ${name} —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞`, 'success');
        currentStatusSpan.textContent = `–°–µ—Å—Å–∏—è ${name} –∞–∫—Ç–∏–≤–Ω–∞`;
        authCodeInput.value = '';
        await loadSessions();
      } catch (e) {
        currentStatusSpan.textContent = '–û—à–∏–±–∫–∞';
        log('–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–¥–∞: ' + e.message, 'error');
      }
    };

    joinGroupBtn.onclick = async () => {
      const name = sessionNameInput.value.trim() || lastCreatedSession;
      const link = joinLinkInput.value.trim();
      if (!name) {
        log('–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é –¥–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è', 'error');
        return;
      }
      const trimmed = link.trim();
      const looksLikeTg =
        trimmed.startsWith('@') ||
        trimmed.toLowerCase().startsWith('t.me/') ||
        trimmed.toLowerCase().startsWith('http://t.me/') ||
        trimmed.toLowerCase().startsWith('https://t.me/');
      if (!trimmed || !looksLikeTg) {
        log('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É: https://t.me/..., t.me/username –∏–ª–∏ @username', 'error');
        return;
      }
      try {
        const res = await fetch(`/api/tg/sessions/${encodeURIComponent(name)}/join`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ link })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏');
        log(`–ó–∞–¥–∞—á–∞ –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –¥–ª—è ${name} –¥–æ–±–∞–≤–ª–µ–Ω–∞: ${link}`, 'success');
        joinLinkInput.value = '';
        await loadSessions();
      } catch (e) {
        log('–û—à–∏–±–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è: ' + e.message, 'error');
      }
    };

    saveIntervalsBtn.onclick = async () => {
      const name = sessionNameInput.value.trim() || lastCreatedSession;
      if (!name) {
        log('–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤', 'error');
        return;
      }
      const min = Number(intervalMinInput.value);
      const max = Number(intervalMaxInput.value);
      if (!Number.isFinite(min) || !Number.isFinite(max)) {
        log('–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (—á–∏—Å–ª–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)', 'error');
        return;
      }
      if (min < 3 || max < min || max > 3600) {
        log('–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 3 –¥–æ 3600 —Å–µ–∫, min ‚â§ max', 'error');
        return;
      }
      try {
        const res = await fetch(`/api/tg/sessions/${encodeURIComponent(name)}/intervals`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ min, max }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤');
        log(`–ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è ${name} –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${min}-${max} —Å–µ–∫`, 'success');
        await loadSessions();
      } catch (e) {
        log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤: ' + e.message, 'error');
      }
    };

    openNotificationsBtn.onclick = async () => {
      try {
        const res = await fetch('/api/tg/notifications?limit=200');
        const data = await res.json();
        lastNotifications = data.notifications || [];
        renderNotifications();
        notifOverlay.style.display = 'flex';
      } catch (e) {
        log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ' + e.message, 'error');
      }
    };

    closeNotificationsBtn.onclick = () => {
      notifOverlay.style.display = 'none';
    };

    clearNotificationsBtn.onclick = async () => {
      try {
        const res = await fetch('/api/tg/notifications', { method: 'DELETE' });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
        lastNotifications = [];
        renderNotifications();
        log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã', 'success');
      } catch (e) {
        log('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ' + e.message, 'error');
      }
    };

    // WebSocket for live updates
    const socket = io();
    socket.on('connect', () => {
      log('WS –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
    });
    socket.on('tg_session_status', () => {
      loadSessions();
    });
    socket.on('tg_join_queue_update', () => {
      loadSessions();
    });

    loadSessions();
  </script>
</body>
</html>


